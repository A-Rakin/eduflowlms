{% extends "base.html" %}

{% block title %}Manage Quiz{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <h1>{{ quiz.title }}</h1>
        <p class="lead">{{ quiz.description }}</p>

        <div class="card mb-4">
            <div class="card-body">
                <h5>Quiz Details</h5>
                <p><strong>Time Limit:</strong> {{ quiz.time_limit or 'No limit' }} minutes</p>
                <p><strong>Passing Score:</strong> {{ quiz.passing_score }}%</p>
                <p><strong>Total Questions:</strong> {{ quiz.questions|length }}</p>
            </div>
        </div>

        <h3>Questions</h3>
        <div class="list-group mb-4">
            {% for question in quiz.questions %}
                <div class="list-group-item">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5>Question {{ loop.index }}</h5>
                        <div>
                            <a href="{{ url_for('edit_question', question_id=question.id) }}" class="btn btn-sm btn-warning">Edit</a>
                            <form method="POST" action="{{ url_for('delete_question', question_id=question.id) }}" style="display: inline;">
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this question?')">Delete</button>
                            </form>
                        </div>
                    </div>
                    <p>{{ question.text }}</p>
                    <p><strong>Type:</strong> {{ question.question_type }}</p>
                    <p><strong>Points:</strong> {{ question.points }}</p>
                    {% if question.options %}
                        <p><strong>Options:</strong></p>
                        <ul>
                            {% set options = question.options|fromjson %}
                            {% for option in options %}
                                <li>{{ option }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                    <p><strong>Correct Answer:</strong> {{ question.correct_answer }}</p>
                </div>
            {% endfor %}
        </div>

        <a href="{{ url_for('add_question', quiz_id=quiz.id) }}" class="btn btn-primary">Add Question</a>
        <a href="{{ url_for('edit_quiz', quiz_id=quiz.id) }}" class="btn btn-warning">Edit Quiz</a>
        <a href="{{ url_for('quiz_results', quiz_id=quiz.id) }}" class="btn btn-info">View Results</a>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Quick Actions</h5>
                <div class="d-grid gap-2">
                    <a href="{{ url_for('manage_course', course_id=quiz.module.course.id) }}" class="btn btn-outline-primary">
                        Back to Course
                    </a>
                    <form method="POST" action="{{ url_for('delete_quiz', quiz_id=quiz.id) }}">
                        <button type="submit" class="btn btn-outline-danger w-100" onclick="return confirm('Delete this quiz?')">
                            Delete Quiz
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Add a custom Jinja filter for parsing JSON
document.addEventListener('DOMContentLoaded', function() {
    // This is handled by the template
});
</script>
{% endblock %}